name: umu-launcher
version: '1.0'  # You can set this to the appropriate version
summary: UMU Launcher
description: |
  UMU Launcher is a tool for managing and launching applications.

confinement: strict  # You can change this to 'classic' if needed

apps:
  umu-run:
    command: bin/umu-run
    plugs:
      - network
      - network-bind
      - home
      - x11
      - wayland
      - pulseaudio
      - opengl
      - removable-media
      - bluez
      - desktop
      - desktop-legacy
      - unity7
      - gsettings
      - udisks2
      - dbus
    environment:
      PATH: $SNAP/bin:$SNAP/usr/bin:$SNAP/usr/lib/vulkan/MangoHud/bin:$SNAP/usr/lib/vulkan/gamescope/bin:$SNAP/usr/lib/vulkan/OBSVkCapture/bin
      LC_ADDRESS: C
      LC_COLLATE: C
      LC_MONETARY: C
      LC_MEASUREMENT: C
      LC_NAME: C
      LC_NUMERIC: C
      LC_TELEPHONE: C
      DBUS_FATAL_WARNINGS: 0
      XDG_CONFIG_DIRS: $SNAP/etc/xdg:$SNAP/usr/lib/x86_64-linux-gnu/GL:$SNAP/usr/lib/i386-linux-gnu/GL
      XDG_DATA_DIRS: $SNAP/share:$SNAP/usr/lib/vulkan/share:$SNAP/usr/share:$SNAP/usr/share/runtime/share:$SNAP/run/host/user-share:$SNAP/run/host/share:$SNAP/usr/lib/pressure-vessel/overrides/share

parts:
  umu-run:
    plugin: dump
    source: https://github.com/Open-Wine-Components/umu-launcher.git
    source-branch: flatpak_work
    build-packages:
      - git
      - make
      - gcc
    override-build: |
      git submodule update --init --recursive
      ./configure.sh --prefix=$SNAP
      make FLATPAK=xtrue install DESTDIR=$SNAP

  platform-bootstrap:
    plugin: dump
    source: .
    override-build: |
      set -e
      mkdir -p $SNAP/bin
      mkdir -p $SNAP/lib/i386-linux-gnu
      mkdir -p $SNAP/lib/i386-linux-gnu/GL
      mkdir -p $SNAP/lib/i386-linux-gnu/dri/intel-vaapi-driver
      mkdir -p $SNAP/lib/debug/lib/i386-linux-gnu
      mkdir -p $SNAP/lib/debug/lib/i386-linux-gnu/GL
      install -Dm644 -t $SNAP/etc ld.so.conf
      mkdir -p $SNAP/lib{,32}/ffmpeg
      mkdir -p $SNAP/share/steam/compatibilitytools.d
      mkdir -p $SNAP/utils $SNAP/share/vulkan
      ln -srv $SNAP/{utils/,}share/vulkan/explicit_layer.d
      ln -srv $SNAP/{utils/,}share/vulkan/implicit_layer.d
      mkdir -p $SNAP/links/lib
      ln -srv $SNAP/lib $SNAP/links/lib/x86_64-linux-gnu
      ln -srv $SNAP/lib32 $SNAP/links/lib/i386-linux-gnu
    stage:
      - -ld.so.conf

  python-flit-core:
    plugin: python
    source: https://files.pythonhosted.org/packages/15/d1/d8798b83e953fd6f86ca9b50f93eec464a9305b0661469c8234e61095481/flit_core-3.7.1.tar.gz
    sha256: 14955af340c43035dbfa96b5ee47407e377ee337f69e70f73064940d27d0a44f

  python-ninja:
    plugin: python
    source: https://files.pythonhosted.org/packages/00/99/5beedbf09e3ec6b617606df42d04c4251959caddbd98397cce21da4c52d1/ninja-1.10.2.3.tar.gz
    sha256: e1b86ad50d4e681a7dbdff05fc23bb52cb773edb90bc428efba33fa027738408
    build-packages:
      - python3-setuptools
      - python3-pip

  python-xlib:
    plugin: python
    source: https://files.pythonhosted.org/packages/source/p/python-xlib/python-xlib-0.33.tar.gz
    sha256: 55af7906a2c75ce6cb280a584776080602444f75815a7aff4d287bb2d7018b32
